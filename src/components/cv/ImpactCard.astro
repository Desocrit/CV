---
import type { ImpactNode } from '../../lib/cv-data';
import Label from '../typography/Label.astro';
import Heading from '../typography/Heading.astro';
import Text from '../typography/Text.astro';

interface Props {
  node: ImpactNode;
}

const { node } = Astro.props;
---

{/* Screen version: Interactive card with hover effects */}
<div
  class:list={[
    'impact-card-wrapper group/card',
    `impact-card-wrapper--${node.color}`,
    // Base styles
    'relative z-[1] bg-background',
    // Animated border pseudo-element via CSS custom properties
    'before:content-[\'\'] before:absolute before:inset-[-1px] before:z-0',
    'before:bg-[conic-gradient(from_var(--border-angle,0deg),transparent_0%,transparent_25%,var(--card-accent)_50%,transparent_75%,transparent_100%)]',
    'before:opacity-0 before:transition-opacity before:duration-300 before:ease-out',
    // Dark mode hover animation
    'hover:before:opacity-100 hover:before:animate-[spin-border_3s_linear_infinite]',
    // Active state (when .is-active-card is added via JS)
    '[&.is-active-card]:before:opacity-100',
    '[&.is-active-card]:before:animate-[spin-border_3s_linear_infinite]',
    // Light mode: hide animated border, use offset shadow instead
    'light:before:!hidden',
    'light:transition-shadow light:duration-150 light:ease-out',
    'light:hover:shadow-[var(--shadow-offset)_var(--shadow-offset)_0px_color-mix(in_srgb,var(--card-accent)_40%,white)]',
    'light:[&.is-active-card]:shadow-[var(--shadow-offset)_var(--shadow-offset)_0px_color-mix(in_srgb,var(--card-accent)_40%,white)]',
    // Hide in print
    'print:hidden',
  ]}
  style={`--card-accent: var(--color-accent-${node.color});`}
  data-header={node.header}
>
  <button
    class="impact-card
      relative z-[1]
      flex justify-between items-center
      p-4 w-full
      border border-border bg-background
      cursor-pointer text-left
      focus-visible:outline-1 focus-visible:outline-[var(--card-accent)] focus-visible:outline-offset-2
      light:border-[0.5px] light:transition-[border-color] light:duration-150 light:ease-out
      light:border-l-[3px] light:border-l-[var(--card-accent)]
      light:group-hover/card:border-[var(--card-accent)]
      light:group-[.is-active-card]/card:border-[var(--card-accent)]"
    type="button"
    aria-label={`${node.title}: ${node.description}`}
    data-prompt={node.prompt}
  >
    <div class="card-content flex flex-col flex-1 min-w-0" aria-hidden="true">
      <Label
        cardHeader
        class="block mb-1 text-[var(--card-accent)] group-hover/card:opacity-100 group-[.is-active-card]/card:opacity-100 light:group-hover/card:opacity-80"
      >
        <span class="light:hidden">[ </span>{node.header}<span class="light:hidden"> ]</span>
      </Label>
      <Heading
        as="h3"
        tiny
        class="card-title m-0 font-sans font-semibold leading-snug"
      >
        {node.title}
      </Heading>
      <Text
        small
        class="card-description mt-1 mb-0 italic leading-snug light:not-italic"
      >
        {node.description}
      </Text>
    </div>
    <span
      class="card-cta
        shrink-0 ml-4
        font-mono text-fluid-sm
        text-[var(--card-accent)] opacity-50
        transition-opacity duration-150 ease-out
        group-hover/card:opacity-100 group-[.is-active-card]/card:opacity-100
        light:font-semibold"
      aria-hidden="true"
    >
      <span class="cta-bracket light:hidden">[</span><span class="cta-arrow light:px-[0.25em]">&gt;</span><span class="cta-bracket light:hidden">]</span>
    </span>
  </button>
</div>
