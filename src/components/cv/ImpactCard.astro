---
import type { ImpactNode } from '../../lib/cv-data';
import Label from '../typography/Label.astro';
import Heading from '../typography/Heading.astro';
import Text from '../typography/Text.astro';

interface Props {
  node: ImpactNode;
}

const { node } = Astro.props;
---

{/* Screen version: Interactive card with hover effects */}
<div
  class:list={[
    'impact-card-wrapper group/card',
    `impact-card-wrapper--${node.color}`,
    // Base styles
    'relative z-[1] bg-background',
    // Animated border pseudo-element via CSS custom properties
    'before:content-[\'\'] before:absolute before:inset-[-1px]',
    'before:bg-[conic-gradient(from_var(--border-angle,0deg),transparent_0%,transparent_25%,var(--card-accent)_50%,transparent_75%,transparent_100%)]',
    'before:opacity-0 before:transition-opacity before:duration-300 before:ease-out before:z-0',
    'hover:before:opacity-100 hover:before:animate-[spin-border_3s_linear_infinite]',
    // Hide in print
    'print:hidden',
  ]}
  style={`--card-accent: var(--color-accent-${node.color});`}
  data-header={node.header}
>
  <button
    class="impact-card
      relative z-[1]
      flex justify-between items-center
      p-4 w-full
      border border-border bg-background
      cursor-pointer text-left
      focus-visible:outline-1 focus-visible:outline-[var(--card-accent)] focus-visible:outline-offset-2
      light:border-l-[3px] light:border-l-[var(--card-accent)]"
    type="button"
    aria-label={`${node.title}: ${node.description}`}
    data-prompt={node.prompt}
  >
    <div class="card-content flex flex-col flex-1 min-w-0" aria-hidden="true">
      <Label
        cardHeader
        class="block mb-1 text-[var(--card-accent)] group-hover/card:opacity-100 group-[.is-active-card]/card:opacity-100 light:group-hover/card:opacity-80"
      >
        <span class="light:hidden">[ </span>{node.header}<span class="light:hidden"> ]</span>
      </Label>
      <Heading
        as="h3"
        tiny
        class="card-title m-0 font-sans font-semibold leading-snug"
      >
        {node.title}
      </Heading>
      <Text
        small
        class="card-description mt-1 mb-0 italic leading-snug light:not-italic"
      >
        {node.description}
      </Text>
    </div>
    <span
      class="card-cta
        shrink-0 ml-4
        font-mono text-fluid-xs
        text-[var(--card-accent)] opacity-50
        transition-opacity duration-150 ease-out
        group-hover/card:opacity-100 group-[.is-active-card]/card:opacity-100"
      aria-hidden="true"
    >
      <span class="cta-bracket">[</span><span class="cta-arrow">&gt;</span><span class="cta-bracket">]</span>
    </span>
  </button>
</div>

<style is:global>
  /* ==========================================================================
     ACTIVE STATE: Trigger hover effects when card is at viewport top
     ========================================================================== */
  .impact-card-wrapper.is-active-card::before {
    opacity: 1;
    animation: spin-border 3s linear infinite;
  }

  /* ==========================================================================
     LIGHT MODE: Impact Card Hover Effects
     Hard offset shadow on hover (architectural blueprint style)
     Disable swirling border animation, use offset shadow instead
     ========================================================================== */

  /* Disable the swirling conic-gradient border animation for light mode */
  [data-theme='light'] .impact-card-wrapper::before {
    display: none !important;
  }

  [data-theme='light'] .impact-card-wrapper.is-active-card {
    box-shadow: var(--shadow-offset) var(--shadow-offset) 0px color-mix(in srgb, var(--card-accent) 40%, white);
  }

  [data-theme='light'] .impact-card-wrapper.is-active-card .impact-card {
    border-color: var(--card-accent);
  }

  /* Impact cards - border color change and offset shadow on hover */
  [data-theme='light'] .impact-card-wrapper {
    transition: box-shadow 0.15s ease-out;
  }

  [data-theme='light'] .impact-card-wrapper:hover {
    box-shadow: var(--shadow-offset) var(--shadow-offset) 0px color-mix(in srgb, var(--card-accent) 40%, white);
  }

  /* Impact card inner element styling for light mode */
  [data-theme='light'] .impact-card {
    border-width: var(--hairline-border);
    transition: border-color 0.15s ease-out;
  }

  [data-theme='light'] .impact-card-wrapper:hover .impact-card {
    border-color: var(--card-accent);
  }

  /* Impact card CTA - hide brackets, just show arrow */
  [data-theme='light'] .card-cta .cta-bracket {
    display: none !important;
  }

  [data-theme='light'] .card-cta {
    font-weight: 600;
  }

  [data-theme='light'] .card-cta .cta-arrow {
    padding: 0 0.25em;
  }

</style>
