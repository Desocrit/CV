---
import type { ImpactNode } from '../../lib/cv-data';
import Section from '../ui/Section.astro';

interface Props {
  nodes: ImpactNode[];
}

const { nodes } = Astro.props;

const toSnakeCase = (str: string) => str.toUpperCase().replace(/\s+/g, '_');
---

<div data-print="hide">
  <Section title="Impact" id="impact">
    <div class="impact-feed">
      {nodes.map((node, nodeIndex) => (
        <div class:list={['pillar', { 'pillar-first': nodeIndex === 0 }]}>
          <h3 class="pillar-label">{toSnakeCase(node.pillar)}</h3>

          <div class="items">
            {node.items.map((item) => (
              <article class="impact-item">
                <p class="primary">{item.primary}</p>
                <p class="detail">{item.detail}</p>
                {item.drilldown && item.action && (
                  <details class="drilldown-details group/drilldown">
                    <summary class="drilldown-toggle">
                      <span class="bracket">[</span>
                      <span class="toggle-text group-open/drilldown:hidden"> {item.action} </span>
                      <span class="toggle-text hidden group-open/drilldown:inline"> HIDE </span>
                      <span class="bracket">]</span>
                    </summary>
                    <div class="drilldown-content">
                      {item.drilldown}
                    </div>
                  </details>
                )}
              </article>
            ))}
          </div>
        </div>
      ))}
    </div>
  </Section>
</div>

<style>
  .impact-feed {
    display: flex;
    flex-direction: column;
  }

  /* Pillar */
  .pillar {
    position: relative;
    margin-top: 2.5rem;
    padding-top: 1rem;
  }

  .pillar::before {
    content: '';
    position: absolute;
    top: 0;
    /* Extend left to cover the section label column */
    left: calc(-1 * (2 / 10 * 100% + var(--spacing-fluid-sm) * 2));
    right: 0;
    height: 1px;
    background-color: var(--color-border);
  }

  .pillar-first {
    margin-top: 0;
    padding-top: 0;
  }

  .pillar-first::before {
    display: none;
  }

  .pillar-label {
    font-family: var(--font-mono);
    font-size: 10px;
    font-weight: 400;
    color: var(--color-muted-foreground);
    letter-spacing: 0.15em;
    text-transform: uppercase;
    margin: 0 0 1.25rem 0;
  }

  /* Items */
  .items {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .impact-item {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .primary {
    font-size: var(--text-fluid-sm);
    font-weight: 500;
    color: var(--color-foreground);
    line-height: 1.5;
    margin: 0;
  }

  .detail {
    font-size: var(--text-fluid-xs);
    color: var(--color-muted-foreground);
    line-height: 1.6;
    margin: 0;
  }

  /* Drilldown toggle */
  .drilldown-details {
    margin-top: 0.25rem;
  }

  .drilldown-toggle {
    display: inline-flex;
    align-items: center;
    cursor: pointer;
    list-style: none;
    font-family: var(--font-mono);
    font-size: var(--text-fluid-2xs);
    color: var(--color-accent-purple);
    transition: filter 0.15s ease;
  }

  .drilldown-toggle::-webkit-details-marker {
    display: none;
  }

  .drilldown-toggle::marker {
    display: none;
    content: '';
  }

  .drilldown-toggle:hover {
    filter: brightness(1.2);
  }

  .drilldown-toggle .bracket,
  .drilldown-toggle .toggle-text {
    color: var(--color-accent-purple);
  }

  .drilldown-content {
    margin-top: 0.5rem;
    padding-left: 0.75rem;
    border-left: 2px solid var(--color-accent-purple);
    font-size: var(--text-fluid-xs);
    color: var(--color-muted-foreground);
    line-height: 1.6;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .pillar {
      margin-top: 1.5rem;
    }

    .pillar::before {
      left: 0;
    }

    .items {
      gap: 1.25rem;
    }
  }
</style>
