---
/**
 * SidebarNav - Contact and action links
 *
 * Contains email, LinkedIn, GitHub links, print button, and theme toggle.
 * Uses SidebarAction for consistent styling across all link types.
 */
import SidebarAction from '../../ui/SidebarAction.astro';
import Stack from '../../layout/Stack.astro';
import EmailIcon from '../../icons/EmailIcon.astro';
import LinkedInIcon from '../../icons/LinkedInIcon.astro';
import GitHubIcon from '../../icons/GitHubIcon.astro';
import SourceIcon from '../../icons/SourceIcon.astro';
import PrinterIcon from '../../icons/PrinterIcon.astro';
import SunIcon from '../../icons/SunIcon.astro';
import MoonIcon from '../../icons/MoonIcon.astro';

interface Props {
  email: string;
  linkedin: string;
  github: string;
  source: string;
}

const { email, linkedin, github, source } = Astro.props;
---

<nav class:list={[
  'sm:col-start-1 sm:row-start-3',
  'print:hidden',
]} aria-label="Contact links">
  <Stack
    gap="sm"
    class="flex-row flex-wrap lg:flex-col"
  >
    <SidebarAction
      href={`mailto:${email}`}
      longform={email}
      screenOnly
      aria-label={`Send email to ${email}`}
    >
      <EmailIcon slot="icon" />
    </SidebarAction>

    <SidebarAction
      href={linkedin}
      external
      longform="LinkedIn"
      screenOnly
      aria-label="View LinkedIn profile (opens in new tab)"
    >
      <LinkedInIcon slot="icon" />
    </SidebarAction>

    <SidebarAction
      href={github}
      external
      longform="GitHub"
      aria-label="View GitHub profile (opens in new tab)"
    >
      <GitHubIcon slot="icon" />
    </SidebarAction>

    <SidebarAction
      href={source}
      external
      longform="Source"
      aria-label="View source code (opens in new tab)"
    >
      <SourceIcon slot="icon" />
    </SidebarAction>

    <SidebarAction
      action="print"
      longform="Print"
      aria-label="Print this page"
    >
      <PrinterIcon slot="icon" />
    </SidebarAction>

    <SidebarAction
      id="theme-toggle"
      action="theme-toggle"
      longform="Light Mode"
      altLongform="Dark Mode"
      aria-label="Light Mode: Switch to light theme"
    >
      <SunIcon slot="icon" />
      <MoonIcon slot="alt-icon" />
    </SidebarAction>
  </Stack>
</nav>

<script>
  function initThemeToggle() {
    const toggle = document.getElementById('theme-toggle');
    const html = document.documentElement;

    if (!toggle) return;

    // Update aria-label based on current theme
    const updateAriaLabel = () => {
      const isLight = html.getAttribute('data-theme') === 'light';
      toggle.setAttribute(
        'aria-label',
        isLight ? 'Dark Mode: Switch to dark theme' : 'Light Mode: Switch to light theme'
      );
    };

    // Set initial aria-label
    updateAriaLabel();

    // Handle toggle click - CSS handles icon/text visibility via data-theme attribute
    toggle.addEventListener('click', () => {
      const isCurrentlyLight = html.getAttribute('data-theme') === 'light';
      const newTheme = isCurrentlyLight ? 'dark' : 'light';

      localStorage.setItem('theme', newTheme);
      html.setAttribute('data-theme', newTheme);

      updateAriaLabel();
    });

    // Also update aria-label if theme changes externally
    const observer = new MutationObserver(updateAriaLabel);
    observer.observe(html, { attributes: true, attributeFilter: ['data-theme'] });
  }

  // Initialize on DOMContentLoaded
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initThemeToggle);
  } else {
    initThemeToggle();
  }

  // Re-initialize after Astro page transitions
  document.addEventListener('astro:page-load', initThemeToggle);
</script>
