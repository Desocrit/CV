---
import type { ImpactNode } from '../../lib/cv-data';
import ImpactCard from './ImpactCard.astro';

interface Props {
  nodes: ImpactNode[];
}

const { nodes } = Astro.props;

// Screen: filter out print-only nodes
const screenNodes = nodes.filter((node) => !node.print_only);
---

{/* Screen: Interactive card grid (hidden in print - Impact data rendered via sidebar Achievements) */}
<section
  aria-label="Key impact metrics"
  class="impact-grid
    grid grid-cols-1 gap-4 items-start mt-2
    sm:grid-cols-2
    print:hidden"
>
  {screenNodes.map((node) => (
    <ImpactCard node={node} />
  ))}
</section>

{/* Keyframes and CSS Houdini property for border animation */}
<style is:global>
  @keyframes spin-border {
    to {
      --border-angle: 360deg;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    @keyframes spin-border {
      to {
        --border-angle: 0deg;
      }
    }
  }

  @property --border-angle {
    syntax: '<angle>';
    initial-value: 0deg;
    inherits: false;
  }
</style>

<script>
  document.addEventListener('click', (e) => {
    const target = e.target as HTMLElement;
    const impactCard = target.closest('.impact-card');

    if (impactCard instanceof HTMLButtonElement) {
      const prompt = impactCard.dataset['prompt'];
      if (prompt) {
        window.dispatchEvent(
          new CustomEvent('open-rag-terminal', {
            detail: { initialQuery: prompt },
          })
        );
      }
    }
  });
</script>
