---
interface Props {
  title: string;
  status: 'Live' | 'Still live' | 'Completed' | 'Active' | 'Success' | string;
  role?: string;
  stack: string[];
  premise: string;
  technicalDetails: string;
  impact: string[];
}

const { title, role, stack, premise, technicalDetails, impact } = Astro.props;

const slug = title.toLowerCase().replace(/\s+/g, '-');
---

<article
  class="project-card group border-t border-border pt-fluid-md pb-2"
  aria-labelledby={`project-${slug}-title`}
  itemscope
  itemtype="https://schema.org/CreativeWork"
>
  <!-- Two-column row layout: COL 1-4 | COL 5-12 -->
  <div class="grid gap-3 lg:grid-cols-12 lg:gap-6">
    <!-- Left Column: Cols 1-4 - Title, Status, Tech Stack -->
    <div class="lg:col-span-4 space-y-2">
      <h3
        id={`project-${slug}-title`}
        class="text-fluid-base font-medium tracking-tight text-foreground"
        itemprop="name"
      >
        {title}
      </h3>

      {role && (
        <p class="font-mono text-fluid-xs text-foreground opacity-70" itemprop="contributor">
          {role}
        </p>
      )}

      <!-- Tech stack as tight mono-list - comment green aesthetic -->
      <div class="tech-stack font-mono text-fluid-xs leading-tight" data-print="hide">
        {stack.join(' / ')}
      </div>
    </div>

    <!-- Right Column: Cols 5-12 - Premise + Impact + Details Toggle -->
    <div class="lg:col-span-8 space-y-3">
      <!-- The Premise - Single line, bold -->
      <p class="text-fluid-sm text-foreground leading-snug" itemprop="description">
        {premise.trim()}
      </p>

      <!-- Impact Metrics - Tight horizontal list with green accents -->
      <ul class="flex flex-wrap gap-x-4 gap-y-1 font-mono text-fluid-xs">
        {impact.map((item) => {
          const cleanItem = item.replace(/^["']|["']$/g, '');
          return (
            <li class="flex items-center gap-1.5 text-foreground opacity-90">
              <span class="impact-slash" aria-hidden="true">//</span>
              <span>{cleanItem}</span>
            </li>
          );
        })}
      </ul>

      <!-- Technical Details - Small [VIEW_DETAILS] toggle - Purple accent -->
      <details class="group/details" data-print="hide">
        <summary class="details-toggle inline-flex cursor-pointer list-none items-center gap-0.5 font-mono text-fluid-xs focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring transition-colors">
          <span class="bracket">[</span>
          <span class="toggle-text group-open/details:hidden">VIEW_DETAILS</span>
          <span class="toggle-text hidden group-open/details:inline">HIDE_DETAILS</span>
          <span class="bracket">]</span>
        </summary>
        <div class="details-content mt-3 pl-3 border-l-2 text-fluid-xs leading-relaxed whitespace-pre-line">
          {technicalDetails.trim()}
        </div>
      </details>
    </div>
  </div>
</article>

<style>
  /* Remove default marker */
  summary::-webkit-details-marker {
    display: none;
  }

  summary::marker {
    display: none;
    content: '';
  }

  /* Tech stack - comment green aesthetic */
  .tech-stack {
    color: var(--color-accent-green);
  }

  /* Impact slash dividers - green accent */
  .impact-slash {
    color: var(--color-accent-green-muted);
    letter-spacing: -0.05em;
  }

  /* Details toggle - purple accent for CTAs */
  .details-toggle {
    color: var(--color-accent-purple);
  }

  .details-toggle:hover {
    color: var(--color-accent-purple);
    filter: brightness(1.2);
  }

  .details-toggle .bracket {
    color: var(--color-accent-purple-muted);
  }

  .details-toggle .toggle-text {
    color: var(--color-accent-purple);
  }

  /* Details content panel */
  .details-content {
    border-color: var(--color-accent-purple-muted);
    color: var(--color-muted-foreground);
  }

  /* Print: Condensed display with bullet points */
  @media print {
    article {
      padding-top: 0.3rem;
      padding-bottom: 0.3rem;
    }

    .grid {
      display: block;
    }

    details {
      display: block;
    }

    summary {
      display: none;
    }

    details > div {
      display: block !important;
      padding-left: 0;
      margin-top: 0.25rem;
      border: none;
    }

    /* Reset colors for print */
    .tech-stack,
    .details-content {
      color: #333 !important;
      border-color: #ccc !important;
    }

    /* Convert inline list to vertical bullet list */
    .project-card ul {
      display: block !important;
      flex-direction: column;
      gap: 0 !important;
      padding-left: 1rem !important;
    }

    .project-card ul li {
      display: list-item !important;
      list-style-type: disc !important;
      margin: 0.1rem 0 !important;
    }

    /* Hide the // slash prefix */
    .impact-slash {
      display: none !important;
    }
  }
</style>
