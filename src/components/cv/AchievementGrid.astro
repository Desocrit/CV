---
import Odometer from '../ui/Odometer.astro';
import Metric from '../typography/Metric.astro';
import Label from '../typography/Label.astro';
import Text from '../typography/Text.astro';
import Stack from '../layout/Stack.astro';

interface Achievement {
  metric: string;
  headline: string;
  description: string;
}

interface Props {
  achievements: Achievement[];
  class?: string;
}

const { achievements, class: className = '' } = Astro.props;

// Transform metric names into SCREAMING_SNAKE_CASE for labels
const toSnakeCase = (str: string) =>
  str.toUpperCase().replace(/\s+/g, '_');
---

<section
  aria-label="Key Achievements"
  class:list={['print:m-0', className]}
  data-achievement-grid
>
  <!-- Three borderless columns separated by whitespace -->
  <div class="flex flex-col lg:flex-row lg:justify-between gap-8 print:flex-row print:gap-4">
    {achievements.map((achievement) => (
      <Stack gap="xs" class="items-center text-center print:flex-1">
        <!-- Metric: Large Geist Mono in White with odometer animation -->
        <Metric
          as="data"
          size="lg"
          class="whitespace-nowrap transition-[text-shadow] duration-500 ease-out print:shadow-none"
          data-achievement-metric
        >
          <Odometer value={achievement.headline} />
        </Metric>
        <!-- Label: Small-caps Geist Mono in Purple -->
        <Label micro color="purple" class="mt-0.5">
          {toSnakeCase(achievement.metric)}
        </Label>
        <!-- Description: One sentence in Geist Sans Slate -->
        <Text small class="leading-snug mt-1">
          {achievement.description}
        </Text>
      </Stack>
    ))}
  </div>
</section>

<script>
  function initAchievementGlow() {
    const metrics = document.querySelectorAll('[data-achievement-metric]');
    if (metrics.length === 0) return;

    // Respect reduced motion preference
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            // Apply glow effect via inline style (Tailwind can't do color-mix text-shadow)
            const el = entry.target as HTMLElement;
            el.style.textShadow = `
              0 0 8px color-mix(in srgb, var(--color-accent-purple) 40%, transparent),
              0 0 16px color-mix(in srgb, var(--color-accent-purple) 20%, transparent)
            `.trim();
          }
        });
      },
      { threshold: 0.5, rootMargin: '0px 0px -10% 0px' }
    );

    metrics.forEach((metric) => observer.observe(metric));
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initAchievementGlow);
  } else {
    initAchievementGlow();
  }
</script>

<style>
  @media (prefers-reduced-motion: reduce) {
    [data-achievement-metric] {
      transition: none;
    }
  }
</style>
