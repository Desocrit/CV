---
/**
 * TechTag - Instrumented Diagnostic Node
 *
 * Interactive technology tag with micro-animation linking to
 * canonical literature or frontier overviews.
 */
interface Props {
  name: string;
  url: string;
  tooltip?: string;
  class?: string;
}

const { name, url, tooltip, class: className = '' } = Astro.props;
---

<a
  href={url}
  target="_blank"
  rel="noopener noreferrer"
  class:list={['tech-tag', className]}
  title={tooltip}
>
  <span class="tech-tag-text">{name}</span>
  <span class="tech-tag-sweep" aria-hidden="true"></span>
</a>

<style>
  /* Match original: font-mono text-[10px] uppercase tracking-wider px-2 py-0.5 border border-border text-muted-foreground */
  .tech-tag {
    --tag-accent: var(--card-accent, var(--color-accent-purple));

    position: relative;
    font-family: var(--font-mono);
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding: 0.125rem 0.5rem;
    border: 1px solid var(--color-border);
    color: var(--color-muted-foreground);
    text-decoration: none;
  }

  .tech-tag-text {
    pointer-events: none;
  }

  /* The Glimmer - tight flashlight sweep on border, hover only */
  .tech-tag-sweep {
    position: absolute;
    inset: -1px;
    padding: 1px;
    background: linear-gradient(
      90deg,
      transparent 0%,
      transparent 35%,
      var(--tag-accent) 48%,
      var(--tag-accent) 52%,
      transparent 65%,
      transparent 100%
    );
    background-size: 250% 100%;
    background-position: 100% 0;
    background-repeat: no-repeat;
    -webkit-mask:
      linear-gradient(#fff 0 0) content-box,
      linear-gradient(#fff 0 0);
    mask:
      linear-gradient(#fff 0 0) content-box,
      linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
    pointer-events: none;
    opacity: 0;
  }

  /* Light mode: disable shimmer, use border color change and offset shadow */
  :global([data-theme='light']) .tech-tag {
    text-transform: none;
    transition: box-shadow 0.15s ease-out, border-color 0.15s ease-out;
  }

  :global([data-theme='light']) .tech-tag:hover {
    border-color: var(--tag-accent);
    box-shadow: 2px 2px 0px color-mix(in srgb, var(--tag-accent) 40%, white);
  }

  :global([data-theme='light']) .tech-tag-sweep {
    display: none;
  }

  /* Dark mode md+: glimmer sweep animation on hover */
  @keyframes glimmer-sweep {
    0% {
      opacity: 1;
      background-position: 100% 0;
    }
    100% {
      opacity: 1;
      background-position: 0% 0;
    }
  }

  @media (min-width: 1024px) {
    :global(:not([data-theme='light'])) .tech-tag:hover .tech-tag-sweep {
      animation: glimmer-sweep 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }
  }

  .tech-tag:focus-visible {
    outline: 2px solid var(--color-ring);
    outline-offset: 2px;
  }

  /* Print styles - use light mode styling */
  @media print {
    .tech-tag {
      text-transform: none;
    }

    .tech-tag-sweep {
      display: none;
    }
  }
</style>
