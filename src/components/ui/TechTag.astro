---
/**
 * TechTag - Instrumented Diagnostic Node
 *
 * Interactive technology tag with micro-animation linking to
 * canonical literature or frontier overviews.
 */
interface Props {
  name: string;
  url: string;
  tooltip?: string;
  class?: string;
}

const { name, url, tooltip, class: className = '' } = Astro.props;
---

<a
  href={url}
  target="_blank"
  rel="noopener noreferrer"
  class:list={[
    'tech-tag',
    'group',
    'relative',
    'inline-block',
    'w-fit',
    'font-mono',
    'text-[0.5rem]',
    'uppercase',
    'tracking-wider',
    'px-2',
    'py-0.5',
    'border',
    'border-border',
    'text-muted-foreground',
    'no-underline',
    // Light mode: remove uppercase, add transition for hover effect
    'light:normal-case',
    'light:font-medium',
    'light:transition-[box-shadow,border-color]',
    'light:duration-150',
    'light:ease-out',
    'light:hover:border-[var(--card-accent,var(--color-accent-purple))]',
    'light:hover:shadow-[2px_2px_0px_color-mix(in_srgb,var(--card-accent,var(--color-accent-purple))_40%,white)]',
    // Focus visible
    'focus-visible:outline-2',
    'focus-visible:outline',
    'focus-visible:outline-ring',
    'focus-visible:outline-offset-2',
    // Print styles
    'print:normal-case',
    className,
  ]}
  title={tooltip}
  style="--tag-accent: var(--card-accent, var(--color-accent-purple));"
>
  <span class="pointer-events-none">{name}</span>
  <span
    class:list={[
      'tech-tag-sweep',
      'absolute',
      'inset-[-1px]',
      'p-px',
      'pointer-events-none',
      'opacity-0',
      // Light mode and print: hide sweep
      'light:hidden',
      'print:hidden',
    ]}
    aria-hidden="true"
  ></span>
</a>

<style>
  /*
   * Glimmer Sweep Effect - Dark Mode Only
   *
   * This CSS cannot be migrated to Tailwind because:
   * 1. Complex gradient with specific color stops and background-size/position animation
   * 2. Mask compositing (mask-composite: exclude) for border-only gradient effect
   * 3. @keyframes definition for the sweep animation
   * 4. :global() selector with theme-aware media query for dark mode hover state
   */
  .tech-tag-sweep {
    background: linear-gradient(
      90deg,
      transparent 0%,
      transparent 35%,
      var(--tag-accent) 48%,
      var(--tag-accent) 52%,
      transparent 65%,
      transparent 100%
    );
    background-size: 250% 100%;
    background-position: 100% 0;
    background-repeat: no-repeat;
    -webkit-mask:
      linear-gradient(#fff 0 0) content-box,
      linear-gradient(#fff 0 0);
    mask:
      linear-gradient(#fff 0 0) content-box,
      linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
  }

  @keyframes glimmer-sweep {
    0% {
      opacity: 1;
      background-position: 100% 0;
    }
    100% {
      opacity: 1;
      background-position: 0% 0;
    }
  }

  /* Dark mode md+: glimmer sweep animation on hover */
  @media (min-width: 1024px) {
    :global(:not([data-theme='light'])) .tech-tag:hover .tech-tag-sweep {
      animation: glimmer-sweep 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }
  }
</style>
