---
interface Props {
  title: string;
  id?: string;
  class?: string;
}

const { title, id, class: className = '' } = Astro.props;
const headingId = id ? `${id}-heading` : undefined;

// Convert title to SCREAMING_SNAKE_CASE for consistency with other sections
const formatTitle = (str: string) =>
  str.toUpperCase().replace(/\s+/g, '_');
---

<section
  class:list={['section-with-label', className]}
  id={id}
  aria-labelledby={headingId}
>
  <!-- Section layout: mini label column + content -->
  <div class="section-grid">
    <!-- Left: Section label (sticky navigation marker) -->
    <nav class="section-label" aria-hidden="true">
      <span class="section-title font-mono text-fluid-2xs">// {formatTitle(title)}</span>
    </nav>

    <!-- Right: Section content -->
    <div class="section-content">
      <h2 id={headingId} class="sr-only">{title}</h2>
      <slot />
    </div>
  </div>
</section>

<style>
  .section-with-label {
    /*
     * Spacing symmetry around horizontal rule:
     * - margin-top: space ABOVE the border-top
     * - padding-top: space BELOW the border-top
     * Both use --section-rule-spacing for visual symmetry
     */
    --section-rule-spacing: var(--spacing-fluid-sm);
    margin-top: var(--section-rule-spacing);
    margin-bottom: var(--spacing-fluid-md);
    padding-top: var(--section-rule-spacing);
    border-top: 1px solid var(--color-border);
  }

  /* First section doesn't need top border or margin */
  .section-with-label:first-child {
    margin-top: 0;
    padding-top: 0;
    border-top: none;
  }

  /* 12-column internal grid: Label (2 cols) + Content (10 cols) */
  .section-grid {
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    gap: var(--spacing-fluid-sm);
    align-items: start;
  }

  .section-label {
    grid-column: span 2;
    position: sticky;
    top: 0;
    align-self: start;
    z-index: 10;
    background-color: var(--color-background);
    padding: var(--spacing-fluid-sm) 0;
    margin-top: calc(-1 * var(--spacing-fluid-sm));
  }

  .section-content {
    grid-column: span 10;
    min-width: 0;
  }

  .section-title {
    color: var(--color-accent-green);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    line-height: 1.4;
    white-space: nowrap;
  }

  /* Light mode: use primary foreground color */
  [data-theme='light'] .section-title {
    color: var(--color-foreground);
  }

  /* Responsive: Stack on smaller screens */
  @media (max-width: 768px) {
    .section-grid {
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    .section-label {
      position: static; /* Remove sticky on mobile */
      margin-top: 0;
      margin-bottom: var(--spacing-fluid-sm);
      padding: 0;
      background-color: transparent;
      z-index: auto;
    }

    .section-content {
      width: 100%;
    }

    .section-title {
      display: block;
    }
  }

  /* Print styles */
  @media print {
    .section-with-label {
      margin-top: 0.4rem;
      margin-bottom: 0.3rem;
    }

    .section-grid {
      grid-template-columns: 5rem 1fr;
      gap: 0.5rem;
    }

    .section-label {
      grid-column: auto;
      position: static; /* Remove sticky for print */
    }

    .section-content {
      grid-column: auto;
    }

    .section-title {
      color: #333 !important;
      font-size: 7pt;
    }
  }
</style>
